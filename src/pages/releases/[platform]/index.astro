---
import type { InferGetStaticPropsType, GetStaticPaths } from "astro";
import type { Platform } from "@lib/replay-api.ts";

import * as Consts from "src/constants";
import LayoutReleases from "@layouts/LayoutReleases.astro";

import PlatformView from "@components/builds/PlatformView.astro";

export const getStaticPaths = (async () => {
  const res = await fetch(`${Consts.BASE_URL_REPLAY_API}/platforms/`);
  const platforms: Array<Platform> = await res.json();

   return platforms.map(platform => ({params: {platform: platform.id}, props: {platforms: platforms}}))
}) satisfies GetStaticPaths;

type Props = InferGetStaticPropsType<typeof getStaticPaths>;

const { platform } = Astro.params;
const { platforms } = Astro.props;
---

<LayoutReleases title="Core Releases" platforms={platforms} selectedPlatform={platform}>
  <PlatformView platform={platform}></PlatformView>
</LayoutReleases>
